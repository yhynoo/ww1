mexican_civil_war = {
    start_civil_war = { ideology = communism size = 0.3 }

    random_country = {
        limit = { original_tag = MEX has_government = communism }
        declare_war_on = { target = COL type = topple_government }

        # add armies
        division_template = { 
            name = "Agrarist Militias" division_names_group = MEX_INF_0 is_locked = no
            regiments = { 
                infantry = { x = 0 y = 0 } infantry = { x = 0 y = 1 }
                infantry = { x = 1 y = 0 } infantry = { x = 1 y = 1 }
            }
        }

        random_owned_controlled_state = { 
            create_unit = {
                division = "name = \"1. Agrarist Militia\" division_template = \"Agrarist Militias\" start_equipment_factor = 0.3" 
                owner = PREV
            }
            create_unit = {
                division = "name = \"2. Agrarist Militia\" division_template = \"Agrarist Militias\" start_equipment_factor = 0.3" 
                owner = PREV
            }
        }
        random_owned_controlled_state = { 
            create_unit = {
                division = "name = \"3. Agrarist Militia\" division_template = \"Agrarist Militias\" start_equipment_factor = 0.3" 
                owner = PREV
            }
            create_unit = {
                division = "name = \"4. Agrarist Militia\" division_template = \"Agrarist Militias\" start_equipment_factor = 0.3" 
                owner = PREV
            }
        }
    }

    random_country = {
        limit = { original_tag = MEX not = { has_government = communism } }

        # add armies
        division_template = { 
            name = "Volunteer Militias" division_names_group = MEX_INF_0 is_locked = no
            regiments = { 
                infantry = { x = 0 y = 0 } infantry = { x = 0 y = 1 }
                infantry = { x = 1 y = 0 } infantry = { x = 1 y = 1 }
            }
        }

        random_owned_controlled_state = { 
            create_unit = {
                division = "name = \"1. Volunteer Militia\" division_template = \"Volunteer Militias\" start_equipment_factor = 0.5" 
                owner = PREV
            }
        }
        random_owned_controlled_state = { 
            create_unit = {
                division = "name = \"2. Volunteer Militia\" division_template = \"Volunteer Militias\" start_equipment_factor = 0.5" 
                owner = PREV
            }
            create_unit = {
                division = "name = \"3. Volunteer Militia\" division_template = \"Volunteer Militias\" start_equipment_factor = 0.3" 
                owner = PREV
            }
        }
        random_owned_controlled_state = { 
            create_unit = {
                division = "name = \"4. Volunteer Militia\" division_template = \"Volunteer Militias\" start_equipment_factor = 0.3" 
                owner = PREV
            }
            create_unit = {
                division = "name = \"5. Volunteer Militia\" division_template = \"Volunteer Militias\" start_equipment_factor = 0.2" 
                owner = PREV
            }
        }
    }
}

german_civil_war_setup = {
    random_country = {
        limit = { original_tag = GER has_government = communism }
        set_cosmetic_tag = GEC
        set_popularities = { communism = 75 democratic = 25 }

        # remove claims on already lost lands
        every_owned_state = {
            limit = { not = { is_controlled_by = ROOT } }
            transfer_state_to = controller
        }

        # add armies
        division_template = { 
            name = "Arbeiter-Sturmtruppen" division_names_group = GER_INF_1 is_locked = no
            regiments = { 
                infantry = { x = 0 y = 0 } infantry = { x = 0 y = 1 }
                infantry = { x = 1 y = 0 } infantry = { x = 1 y = 1 }
            }
        }

        random_owned_controlled_state = { 
            create_unit = {
                division = "name = \"1. Arbeiter-Sturmregiment\" division_template = \"Arbeiter-Sturmtruppen\" start_equipment_factor = 0.3" 
                owner = PREV
            }
            create_unit = {
                division = "name = \"2. Arbeiter-Sturmregiment\" division_template = \"Arbeiter-Sturmtruppen\" start_equipment_factor = 0.3" 
                owner = PREV
            }
        }
        random_owned_controlled_state = { 
            create_unit = {
                division = "name = \"4. Arbeiter-Reg. 'Rosa Luxemburg'\" division_template = \"Arbeiter-Sturmtruppen\" start_equipment_factor = 0.3" 
                owner = PREV
            }
            create_unit = {
                division = "name = \"8. Arbeiter-Regiment\" division_template = \"Arbeiter-Sturmtruppen\" start_equipment_factor = 0.3" 
                owner = PREV
            }
        }
        random_owned_controlled_state = { 
            create_unit = {
                division = "name = \"6. Arbeiter-Reg. 'Ernst Th√§lmann'\" division_template = \"Arbeiter-Sturmtruppen\" start_equipment_factor = 0.3" 
                owner = PREV
            }
        }
        random_owned_controlled_state = { 
            create_unit = {
                division = "name = \"11. Arbeiter-Reg. 'Roter Stern'\" division_template = \"Arbeiter-Sturmtruppen\" start_equipment_factor = 0.3" 
                owner = PREV
            }
            create_unit = {
                division = "name = \"12. Arbeiter-Regiment\" division_template = \"Arbeiter-Sturmtruppen\" start_equipment_factor = 0.3" 
                owner = PREV
            }
        }
    }

     random_country = {
        limit = { original_tag = GER not = { has_government = communism } }

        set_cosmetic_tag = GEX
        if = {
            limit = { has_government = monarchism }
            set_popularities = { communism = 5 monarchism = 65 democratic = 30 }
        }
        if = {
            limit = { has_government = democratic }
            set_popularities = { communism = 5 monarchism = 35 democratic = 60 }
        }

        # remove claims on already lost lands
        every_owned_state = {
            limit = { not = { is_controlled_by = ROOT } }
            transfer_state_to = controller
        }

        # add armies
        division_template = { 
            name = "Freikorps" division_names_group = GER_INF_1 is_locked = no
            regiments = { 
                infantry = { x = 0 y = 0 } infantry = { x = 0 y = 1 }
                infantry = { x = 1 y = 0 } infantry = { x = 1 y = 1 }
            }
        }

        random_owned_controlled_state = { 
            create_unit = {
                division = "name = \"1. Freikorps-Regiment\" division_template = \"Freikorps\" start_equipment_factor = 0.3" 
                owner = PREV
            }
        }
        random_owned_controlled_state = { 
            create_unit = {
                division = "name = \"3. Freikorps-Regiment 'Eiche'\" division_template = \"Freikorps\" start_equipment_factor = 0.3" 
                owner = PREV
            }
        }
        random_owned_controlled_state = { 
            create_unit = {
                division = "name = \"6. Freikorps-Regiment'\" division_template = \"Freikorps\" start_equipment_factor = 0.3" 
                owner = PREV
            }
        }
        random_owned_controlled_state = { 
            create_unit = {
                division = "name = \"7. Freikorps-Regiment\" division_template = \"Freikorps\" start_equipment_factor = 0.3" 
                owner = PREV
            }
        }
    }

    every_country = {
        limit = { original_tag = GER }
        set_rule = { can_join_factions = no }
    }

    every_country = {
        limit = { has_guaranteed = GER }
        diplomatic_relation = { country = GER relation = guarantee active = no }
    }

    every_country = {
        limit = { is_guaranteed_by = GER }
        GER = { diplomatic_relation = { country = PREV relation = guarantee active = no } }
    }
}

soviet_civil_war_setup = {
    random_country = {
        limit = { original_tag = SOV has_government = communism }
        
        set_cosmetic_tag = SOC
        set_popularities = { communism = 65 democratic = 25 monarchism = 10 }
        remove_decision = agitation_mission

        # remove claims on already lost lands
        every_owned_state = {
            limit = { not = { is_controlled_by = ROOT } }
            transfer_state_to = controller
        }

        # add armies
        division_template = { 
            name = "Arbeiter-Sturmtruppen" division_names_group = SOV_INF_1 is_locked = no
            regiments = { 
                infantry = { x = 0 y = 0 } infantry = { x = 0 y = 1 }
                infantry = { x = 1 y = 0 } infantry = { x = 1 y = 1 }
            }
        }

        random_owned_controlled_state = { 
            create_unit = {
                division = "name = \"1. Arbeiter-Sturmtruppen\" division_template = \"Arbeiter-Sturmtruppen\" start_equipment_factor = 0.3" 
                owner = PREV
            }
            create_unit = {
                division = "name = \"2. Arbeiter-Sturmtruppen\" division_template = \"Arbeiter-Sturmtruppen\" start_equipment_factor = 0.3" 
                owner = PREV
            }
        }
        random_owned_controlled_state = { 
            create_unit = {
                division = "name = \"3. Arbeiter-Sturmtruppen\" division_template = \"Arbeiter-Sturmtruppen\" start_equipment_factor = 0.3" 
                owner = PREV
            }
            create_unit = {
                division = "name = \"4. Arbeiter-Sturmtruppen\" division_template = \"Arbeiter-Sturmtruppen\" start_equipment_factor = 0.3" 
                owner = PREV
            }
        }

        random_owned_controlled_state = { 
            create_unit = {
                division = "name = \"5. Arbeiter-Sturmtruppen\" division_template = \"Arbeiter-Sturmtruppen\" start_equipment_factor = 0.3" 
                owner = PREV
            }
            create_unit = {
                division = "name = \"7. Arbeiter-Sturmtruppen\" division_template = \"Arbeiter-Sturmtruppen\" start_equipment_factor = 0.3" 
                owner = PREV
            }
        }
        random_owned_controlled_state = { 
            create_unit = {
                division = "name = \"10. Arbeiter-Sturmtruppen\" division_template = \"Arbeiter-Sturmtruppen\" start_equipment_factor = 0.3" 
                owner = PREV
            }
            create_unit = {
                division = "name = \"11. Arbeiter-Sturmtruppen\" division_template = \"Arbeiter-Sturmtruppen\" start_equipment_factor = 0.3" 
                owner = PREV
            }
        }

        random_owned_controlled_state = { 
            create_unit = {
                division = "name = \"12. Arbeiter-Sturmtruppen\" division_template = \"Arbeiter-Sturmtruppen\" start_equipment_factor = 0.3" 
                owner = PREV
            }
            create_unit = {
                division = "name = \"15. Arbeiter-Sturmtruppen\" division_template = \"Arbeiter-Sturmtruppen\" start_equipment_factor = 0.3" 
                owner = PREV
            }
        }
        random_owned_controlled_state = { 
            create_unit = {
                division = "name = \"16. Arbeiter-Sturmtruppen\" division_template = \"Arbeiter-Sturmtruppen\" start_equipment_factor = 0.3" 
                owner = PREV
            }
            create_unit = {
                division = "name = \"17. Arbeiter-Sturmtruppen\" division_template = \"Arbeiter-Sturmtruppen\" start_equipment_factor = 0.3" 
                owner = PREV
            }
        }

    }

    random_country = {
        limit = { original_tag = SOV not = { has_government = communism } }

        set_cosmetic_tag = SOO
        if = {
            limit = { has_government = monarchism }
            set_popularities = { communism = 5 monarchism = 60 democratic = 35 }
        }
        if = {
            limit = { has_government = democratic }
            set_popularities = { communism = 15 monarchism = 35 democratic = 50 }
        }
        remove_decision = agitation_mission

        # remove claims on already lost lands and peace out.
        every_owned_state = {
            limit = { not = { is_controlled_by = PREV } }
            transfer_state_to = controller
        }

        if = {
            limit = { is_in_faction = yes }
            leave_faction = yes
        }

        every_country = {
            limit = { has_war_with = PREV not = { original_tag = SOV } }
            white_peace = PREV
        }

        # add armies
        division_template = { 
            name = "Volunteer Militias" division_names_group = SOV_INF_1 is_locked = no
            regiments = { 
                infantry = { x = 0 y = 0 } infantry = { x = 0 y = 1 }
                infantry = { x = 1 y = 0 } infantry = { x = 1 y = 1 }
            }
        }

        random_owned_controlled_state = { 
            create_unit = {
                division = "name = \"1. Volunteer Militia\" division_template = \"Volunteer Militias\" start_equipment_factor = 0.5" 
                owner = PREV
            }
        }
        random_owned_controlled_state = { 
            create_unit = {
                division = "name = \"2. Volunteer Militia\" division_template = \"Volunteer Militias\" start_equipment_factor = 0.5" 
                owner = PREV
            }
            create_unit = {
                division = "name = \"3. Volunteer Militia\" division_template = \"Volunteer Militias\" start_equipment_factor = 0.3" 
                owner = PREV
            }
        }
        random_owned_controlled_state = { 
            create_unit = {
                division = "name = \"4. Volunteer Militia\" division_template = \"Volunteer Militias\" start_equipment_factor = 0.3" 
                owner = PREV
            }
            create_unit = {
                division = "name = \"5. Volunteer Militia\" division_template = \"Volunteer Militias\" start_equipment_factor = 0.2" 
                owner = PREV
            }
        }
        random_owned_controlled_state = { 
            create_unit = {
                division = "name = \"8. Volunteer Militia\" division_template = \"Volunteer Militias\" start_equipment_factor = 0.5" 
                owner = PREV
            }
        }
        random_owned_controlled_state = { 
            create_unit = {
                division = "name = \"10. Volunteer Militia\" division_template = \"Volunteer Militias\" start_equipment_factor = 0.5" 
                owner = PREV
            }
        }
    }

    # diplomacy
    every_country = {
        limit = { original_tag = SOV }
        set_rule = { can_join_factions = no }
    }
    
    every_country = {
        limit = { has_guaranteed = SOV }
        diplomatic_relation = { country = SOV relation = guarantee active = no }
    }

    every_country = {
        limit = { is_guaranteed_by = SOV }
        SOV = { diplomatic_relation = { country = PREV relation = guarantee active = no } }
    }
}