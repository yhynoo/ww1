add_namespace = soviet_kornilov

country_event = {
    id = soviet_kornilov.1
    title = "Failure or Treason?"
    desc = soviet_kornilov.1.d

    trigger = {
        has_completed_focus = SOV_traditionalism                # we didn't democratize
        has_stability < 0.5

        any_state = {
            or = { state = 195 state = 202 state = 219 }        # Petrograd, Kyiv or Moscow has fallen, front is collapsing
            not = { is_controlled_by = SOV }
        }

        has_government = monarchism
    }
    fire_only_once = yes

    mean_time_to_happen = {
        days = 14
        modifier = { monarchism > 0.5 factor = 2 }
    }

    option = {
        name = "Let the Tsar take the responsibility."
        add_political_power = -50

        hidden_effect = { news_event = { id = soviet_kornilov.2 days = 7 random_days = 7 } }
    }
    option = {
        name = "The General Staff is incompetent."
        add_war_support = -0.1

        hidden_effect = { country_event = { id = soviet_kornilov.3 days = 7 random_days = 7 } }
    }
}

news_event = {
    id = soviet_kornilov.2
    title = "Kornilov Affair"
    desc = soviet_kornilov.2.d

    is_triggered_only = yes
    major = yes

    option = {
        name = "Interesting."
        
        if = {
            limit = { tag = SOV }
            add_popularity = { ideology = authoritarianism popularity = 0.2 }

            set_politics = { 
                ruling_party = authoritarianism elections_allowed = no
            }
        }
    }
}

country_event = {
    id = soviet_kornilov.3
    title = "The Emperor or the Empire?"
    desc = soviet_kornilov.3.d

    is_triggered_only = yes
    trigger = { has_government = monarchism }

    immediate = {
        hidden_effect = { add_popularity = { ideology = monarchism popularity = -0.1 } }
    }

    option = {
        name = "This cannot continue."
        add_popularity = { ideology = authoritarianism popularity = 0.05 }

        hidden_effect = { news_event = { id = soviet_kornilov.4 days = 7 random_days = 7 } }
    }
    option = {
        name = "We must maintain the monarchy."
        add_stability = -0.05

        hidden_effect = { news_event = { id = soviet_kornilov.5 days = 7 random_days = 7 } }
    }
}

news_event = {
    id = soviet_kornilov.4
    title = "Militarists Take Over the Government?"
    desc = soviet_kornilov.4.d

    is_triggered_only = yes

    option = {
        name = "We shall see where this takes us."

        add_popularity = { ideology = authoritarianism popularity = 0.05 }
        add_stability = 0.1
    }
}

news_event = {
    id = soviet_kornilov.5
    title = "Kornilov's Coup in [SOV.GetNameDef]!"
    desc = soviet_kornilov.5.d

    is_triggered_only = yes
    trigger = { has_government = monarchism }
    major = yes

    option = {
        name = "Awful."

        if = {
            limit = { tag = SOV }

            start_civil_war = { 
                ideology = authoritarianism size = party_popularity@authoritarianism 
                states = { 40 249 250 251 252 256 329 397 398 400 403 516 568 579 582 590 644 }
            }
        }
    }
}